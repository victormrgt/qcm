<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QCM — 10 questions</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;max-width:900px}
    h1{font-size:1.6rem}
    .question{border:1px solid #eee;padding:12px;border-radius:8px;margin:10px 0}
    .choices label{display:block;margin:6px 0;cursor:pointer}
    .controls{display:flex;gap:8px;margin:12px 0}
    .result{padding:12px;background:#f3f9f3;border:1px solid #d6efd6;border-radius:6px;margin-top:12px}
    .linkout{word-break:break-all}
    button{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:white;cursor:pointer}
  </style>
</head>
<body>
  <h1>QCM — 10 questions</h1>
  <p>Choisissez une réponse par question (4 possibilités). Cliquez sur <strong>Noter</strong> pour calculer la note, ou <strong>Générer un lien</strong> pour créer un lien partageable qui pré-remplira les réponses et affichera automatiquement la note.</p>

  <div id="quiz"></div>

  <div class="controls">
    <button id="gradeBtn">Noter</button>
    <button id="linkBtn">Générer un lien</button>
    <button id="resetBtn">Réinitialiser</button>
    <button id="copyBtn">Copier le lien</button>
  </div>

  <div id="output"></div>

  <script>
    // --- QUESTIONS ---
    // Modifiez ces questions / réponses / index de la bonne réponse si vous voulez
    const QUESTIONS = [
      {q: "Quelle est la capitale de la France ?", choices: ["Marseille","Lyon","Paris","Bordeaux"], correct: 2},
      {q: "Combien de jours y a-t-il en février (année non bissextile) ?", choices: ["28","29","30","31"], correct: 0},
      {q: "Quel est l'élément chimique O ?", choices: ["Or","Oxygène","Osmium","Oganesson"], correct: 1},
      {q: "Quel instrument a 6 cordes en général ?", choices: ["Violon","Guitare","Saxophone","Trompette"], correct: 1},
      {q: "Quelle est la couleur du ciel par temps clair ?", choices: ["Vert","Bleu","Rouge","Noir"], correct: 1},
      {q: "1000 mètres = ?", choices: ["10 m","100 m","1000 m","1 km"], correct: 3},
      {q: "Quel animal est connu pour sa lenteur ?", choices: ["Guépard","Escargot","Faucon","Dauphin"], correct: 1},
      {q: "Quel est le résultat de 7 × 8 ?", choices: ["54","56","58","60"], correct: 1},
      {q: "Quelle planète est la plus proche du Soleil ?", choices: ["Vénus","Terre","Mercure","Mars"], correct: 2},
      {q: "Quel est le symbole chimique du sodium ?", choices: ["S","Na","N","Sd"], correct: 1}
    ];

    const quizEl = document.getElementById('quiz');
    const outputEl = document.getElementById('output');

    function render(answers = []){
      quizEl.innerHTML = '';
      QUESTIONS.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<strong>Q${i+1}.</strong> ${item.q}`;
        const choices = document.createElement('div');
        choices.className = 'choices';
        item.choices.forEach((c, j) => {
          const id = `q${i}_c${j}`;
          const checked = answers[i] != null && Number(answers[i]) === j ? 'checked' : '';
          choices.innerHTML += `<label><input type="radio" name="q${i}" value="${j}" ${checked}> ${c}</label>`;
        });
        div.appendChild(choices);
        quizEl.appendChild(div);
      });
    }

    // Read answers from URL hash if present
    function parseHash(){
      if(!location.hash) return null;
      try{
        const h = location.hash.substring(1); // remove #
        const params = new URLSearchParams(h);
        const answersParam = params.get('answers');
        if(!answersParam) return null;
        const arr = decodeURIComponent(answersParam).split(',');
        if(arr.length !== QUESTIONS.length) return null;
        return arr;
      }catch(e){return null}
    }

    function getSelectedAnswers(){
      return QUESTIONS.map((_, i) => {
        const sel = document.querySelector(`input[name=q${i}]:checked`);
        return sel ? Number(sel.value) : null;
      });
    }

    function grade(answers){
      let score = 0;
      for(let i=0;i<QUESTIONS.length;i++){
        if(answers[i] === QUESTIONS[i].correct) score++;
      }
      return score;
    }

    document.getElementById('gradeBtn').addEventListener('click', ()=>{
      const sel = getSelectedAnswers();
      const score = grade(sel);
      outputEl.innerHTML = `<div class="result">Vous avez obtenu <strong>${score}/${QUESTIONS.length}</strong>.</div>`;
    });

    document.getElementById('linkBtn').addEventListener('click', ()=>{
      const sel = getSelectedAnswers();
      // if some unanswered, replace by -1 to keep length
      const arr = sel.map(v => v==null ? -1 : v);
      const encoded = encodeURIComponent(arr.join(','));
      const base = location.origin + location.pathname;
      const url = `${base}#answers=${encoded}`;
      outputEl.innerHTML = `<div class="result">Lien généré : <div class="linkout"><a href="${url}">${url}</a></div></div>`;
      lastGeneratedLink = url;
    });

    document.getElementById('copyBtn').addEventListener('click', async ()=>{
      if(!lastGeneratedLink){ outputEl.innerHTML = '<div class="result">Aucun lien à copier — générez d\'abord un lien.</div>'; return }
      try{
        await navigator.clipboard.writeText(lastGeneratedLink);
        outputEl.innerHTML = '<div class="result">Lien copié dans le presse-papiers.</div>';
      }catch(e){ outputEl.innerHTML = `<div class="result">Impossible de copier automatiquement. Voici le lien : <div class="linkout">${lastGeneratedLink}</div></div>`}
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      render(Array(QUESTIONS.length).fill(null));
      outputEl.innerHTML = '';
      history.replaceState(null, '', location.pathname);
    });

    // on load: if hash contains answers, prefill and auto-grade
    let lastGeneratedLink = null;
    const hashAnswers = parseHash();
    if(hashAnswers){
      render(hashAnswers.map(v => v === '-1' ? null : Number(v)));
      // auto grade
      const parsed = hashAnswers.map(v => v === '-1' ? null : Number(v));
      const score = grade(parsed);
      outputEl.innerHTML = `<div class="result">(Depuis le lien) Vous avez obtenu <strong>${score}/${QUESTIONS.length}</strong>.</div>`;
      lastGeneratedLink = location.href;
    }else{
      render();
    }

  </script>
</body>
</html>
